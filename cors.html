<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jalwa.Game - CORS Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #0A0E27;
            color: white;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #141B3D;
            padding: 30px;
            border-radius: 12px;
        }
        
        h1 {
            color: #00E5CC;
            margin-bottom: 20px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #1A2347;
            border-radius: 8px;
        }
        
        h2 {
            color: #00E5CC;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: #0A0E27;
            border: 2px solid #00E5CC;
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #00E5CC, #00FFDD);
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            color: #0A0E27;
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 229, 204, 0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .result {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }
        
        .error {
            background: rgba(255, 82, 82, 0.2);
            border: 1px solid #FF5252;
            color: #FF5252;
        }
        
        .info {
            background: rgba(0, 229, 204, 0.2);
            border: 1px solid #00E5CC;
            color: #00E5CC;
        }
        
        code {
            background: #0A0E27;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .warning {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #FF9800;
            color: #FF9800;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Jalwa API - CORS Troubleshooting</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è CORS Issue Detected</strong><br>
            The browser is blocking direct API calls. Try the solutions below:
        </div>

        <div class="section">
            <h2>Solution 1: Test Login (Direct - Will Likely Fail)</h2>
            <input type="tel" id="phone1" placeholder="Phone Number (e.g., 917508580561)" value="917508580561">
            <input type="password" id="password1" placeholder="Password" value="">
            <button onclick="testDirectLogin()">Test Direct API Call</button>
            <div id="result1" class="result"></div>
        </div>

        <div class="section">
            <h2>Solution 2: Browser Extension Method</h2>
            <ol>
                <li>Install a CORS browser extension:
                    <ul>
                        <li><strong>Chrome/Edge:</strong> "Allow CORS: Access-Control-Allow-Origin"</li>
                        <li><strong>Firefox:</strong> "CORS Everywhere"</li>
                    </ul>
                </li>
                <li>Enable the extension</li>
                <li>Click the button above again</li>
            </ol>
            <div class="info result" style="display: block; margin-top: 15px;">
                <strong>Note:</strong> This is for development/testing only!
            </div>
        </div>

        <div class="section">
            <h2>Solution 3: Use Local Proxy Server</h2>
            <p>Create a simple Node.js proxy server:</p>
            <ol>
                <li>Create <code>proxy-server.js</code>:
<pre style="background: #0A0E27; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 10px 0;">
const express = require('express');
const cors = require('cors');
const axios = require('axios');

const app = express();
app.use(cors());
app.use(express.json());

app.post('/api/*', async (req, res) => {
  try {
    const url = `https://api.jalwaapi.com${req.path.replace('/api', '')}`;
    const response = await axios.post(url, req.body, {
      headers: req.headers
    });
    res.json(response.data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000, () => console.log('Proxy on port 3000'));
</pre>
                </li>
                <li>Install: <code>npm install express cors axios</code></li>
                <li>Run: <code>node proxy-server.js</code></li>
                <li>Update baseURL in jalwa-api.js to: <code>http://localhost:3000/api/webapi</code></li>
            </ol>
        </div>

        <div class="section">
            <h2>Solution 4: Test What Error You're Getting</h2>
            <button onclick="diagnoseError()">Run Diagnostic Test</button>
            <div id="diagnostic" class="result"></div>
        </div>

        <div class="section">
            <h2>Current Error Details</h2>
            <p>Check your browser console (F12) for detailed error messages. Common errors:</p>
            <ul>
                <li><strong>"Access to fetch blocked by CORS policy"</strong> ‚Üí Use extension or proxy</li>
                <li><strong>"Failed to fetch"</strong> ‚Üí Network issue or CORS</li>
                <li><strong>"Invalid credentials"</strong> ‚Üí Wrong username/password</li>
                <li><strong>"Token expired"</strong> ‚Üí Need to login again</li>
            </ul>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script>
        function generateRandom(length = 32) {
            const chars = '0123456789abcdef';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function generateSignature(data) {
            const jsonStr = JSON.stringify(data, Object.keys(data).sort());
            return CryptoJS.MD5(jsonStr).toString(CryptoJS.enc.Hex).toUpperCase();
        }

        async function testDirectLogin() {
            const phone = document.getElementById('phone1').value;
            const password = document.getElementById('password1').value;
            const result = document.getElementById('result1');
            const button = event.target;
            
            if (!phone || !password) {
                result.className = 'result error';
                result.style.display = 'block';
                result.innerHTML = '‚ùå Please enter both phone and password';
                return;
            }
            
            button.disabled = true;
            button.textContent = 'Testing...';
            result.style.display = 'none';
            
            const random = generateRandom();
            const timestamp = Math.floor(Date.now() / 1000);
            const deviceId = '6aab05dedf11c45469f33b89b97cde4a';
            
            const sigData = {
                deviceId: deviceId,
                language: 0,
                logintype: 'mobile',
                phonetype: 0,
                pwd: password,
                random: random,
                username: phone
            };
            
            const signature = generateSignature(sigData);
            
            const payload = {
                username: phone,
                pwd: password,
                phonetype: 0,
                logintype: 'mobile',
                packId: '',
                deviceId: deviceId,
                language: 0,
                random: random,
                timestamp: timestamp,
                signature: signature
            };
            
            console.log('üì§ Request payload:', payload);
            
            try {
                const response = await fetch('https://api.jalwaapi.com/api/webapi/Login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json;charset=UTF-8',
                        'Origin': 'https://jalwa.vip',
                        'Referer': 'https://jalwa.vip/'
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('üì• Response status:', response.status);
                const data = await response.json();
                console.log('üì• Response data:', data);
                
                if (data.code === 0) {
                    result.className = 'result success';
                    result.innerHTML = `
                        ‚úÖ <strong>Login Successful!</strong><br>
                        Token: ${data.data.token.substring(0, 50)}...<br>
                        User: ${data.data.userName}<br>
                        Balance: ‚Çπ${data.data.amount}
                    `;
                } else {
                    result.className = 'result error';
                    result.innerHTML = `‚ùå <strong>Login Failed</strong><br>Error: ${data.msg}`;
                }
                result.style.display = 'block';
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                result.className = 'result error';
                
                if (error.message.includes('Failed to fetch')) {
                    result.innerHTML = `
                        ‚ùå <strong>CORS Error Detected!</strong><br><br>
                        <strong>The browser blocked the request.</strong><br><br>
                        <strong>Solutions:</strong><br>
                        1. Install "Allow CORS" browser extension and enable it<br>
                        2. Use the proxy server method (Solution 3 above)<br>
                        3. Host the app on the same domain as the API<br><br>
                        <strong>Error:</strong> ${error.message}
                    `;
                } else {
                    result.innerHTML = `‚ùå <strong>Error:</strong> ${error.message}`;
                }
                result.style.display = 'block';
            } finally {
                button.disabled = false;
                button.textContent = 'Test Direct API Call';
            }
        }

        async function diagnoseError() {
            const result = document.getElementById('diagnostic');
            const button = event.target;
            
            button.disabled = true;
            button.textContent = 'Diagnosing...';
            
            result.className = 'result info';
            result.style.display = 'block';
            result.innerHTML = 'üîç Running diagnostics...<br><br>';
            
            // Test 1: Network connectivity
            result.innerHTML += '1Ô∏è‚É£ Testing network connectivity...<br>';
            try {
                await fetch('https://api.jalwaapi.com', { mode: 'no-cors' });
                result.innerHTML += '‚úÖ Network is working<br><br>';
            } catch (e) {
                result.innerHTML += '‚ùå Network error: ' + e.message + '<br><br>';
            }
            
            // Test 2: CORS check
            result.innerHTML += '2Ô∏è‚É£ Testing CORS policy...<br>';
            try {
                const response = await fetch('https://api.jalwaapi.com/api/webapi/Login', {
                    method: 'OPTIONS'
                });
                result.innerHTML += '‚úÖ CORS preflight passed<br><br>';
            } catch (e) {
                result.innerHTML += '‚ùå CORS is blocking requests<br>';
                result.innerHTML += '<strong>Solution needed:</strong> Use CORS extension or proxy<br><br>';
            }
            
            // Test 3: Check if CryptoJS is loaded
            result.innerHTML += '3Ô∏è‚É£ Checking dependencies...<br>';
            if (typeof CryptoJS !== 'undefined') {
                result.innerHTML += '‚úÖ CryptoJS library loaded<br><br>';
            } else {
                result.innerHTML += '‚ùå CryptoJS not loaded<br><br>';
            }
            
            result.innerHTML += '<strong>Diagnosis Complete!</strong><br>';
            result.innerHTML += 'Check the results above and browser console (F12) for more details.';
            
            button.disabled = false;
            button.textContent = 'Run Diagnostic Test';
        }
    </script>
</body>
</html>
